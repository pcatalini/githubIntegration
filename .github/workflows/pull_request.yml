
name: slack

# Controls when the workflow will run
on:
  pull_request:
    branches: [ main ]
jobs:
  slackNotification:
    name: Slack Notification
    runs-on: ubuntu-latest
    steps:
      - name: Jira Login
        uses: atlassian/gajira-login@v2.0.0
        env:
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
          
      #try to find jira key
      - name: Find in commit messages
        id: jira_founded_ticket
        uses: atlassian/gajira-find-issue-key@master
        with:
          string: ${{ github.event.pull_request.title }}
      
      
      
      - name: Jira Create issue
        id: jira_ticket
        if: ${{!steps.jira_founded_ticket.outputs.issue}}
        uses: atlassian/gajira-create@v2.0.1
        with:
          # Key of the project
          project: GIT
          # Type of the issue to be created. Example: 'Incident'
          issuetype: Task
          # Issue summary
          summary: ${{github.event.pull_request.title}}
          # Issue description
          description: ${{github.event.pull_request.body}} see more ${{github.event.pull_request.html_url}}
          
      - name: slack-send
        uses: slackapi/slack-github-action@v1.15.0
        with:
          channel-id: C02DGE4CBFY
          slack-message: 'New Pull request see more ${{secrets.JIRA_BASE_URL}}/browse/${{steps.jira_founded_ticket.outputs.issue}}' 
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_TOKEN }}
          
